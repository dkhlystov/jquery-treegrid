!function(e){e.fn.treegrid=function(n){return t[n]?t[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void e.error("Method with name "+n+" does not exists for jQuery.treegrid"):function(n){var r=e(this),a=e.extend({},e.fn.treegrid.defaults,n);return r.each(function(){var n=e(this);n.data("treegrid-settings",a),a.clickAllTd?n.on("click",">tbody>tr>td:first-child>",p).on("mousedown",">tbody>tr>td:first-child>",L):n.on("click",">tbody>tr>td:first-child>.treegrid-container>.fa",p).on("mousedown",">tbody>tr>td:first-child>.treegrid-container",L),f(t.getRoots.call(n),0)})}.apply(this,arguments)},e.fn.treegrid.defaults={source:null,enableMove:!1,moveDistance:10,moveHandle:!1,onExpand:function(){return!0},onCollapse:function(){return!0},onAdd:function(){},onMoveStart:function(){},onMoveStop:function(){},onMoveOver:function(){return!0},onMoveOut:function(){},onMove:function(){return!0},iconOpen:"fa-caret-right",iconClose:"fa-caret-down",defaulIconIsNull:!1,onActionExpand:null,maxLevelTree:3,marginLeftAdd:10,arrayLevelBackgroundColor:null,arrayLevelBackgroundColor2:null,arrayLevelTextColor:null,marginExpand:"0.6rem",clickAllTd:!0};var t={option:function(t,n){var r=this.data("treegrid-settings");return"string"===e.type(t)&&void 0!==n&&(t={optionName:n}),e.isPlainObject(t)?(r=e.extend({},r,t),this.data("treegrid-settings",r)):"string"===e.type(t)?r[t]:r},getId:function(){return s(this)},getDepth:function(){return this.data("treegrid-depth")},toggle:function(){return this.each(function(){$this=e(this),u($this)?t.collapse.call($this):c($this)&&t.expand.call($this)})},expand:function(){return this.each(function(){var n=e(this);c(n)&&(n.data("loaded")||function(n){var r=n.closest("table").data("treegrid-settings");d(n).not(n).remove(),e.isFunction(r.source)&&!n.hasClass("loading")&&(n.addClass("loading"),r.source.call(n,s(n),function(e){n.removeData("loadNeeded").data("loaded",!0),a(n,e),n.removeClass("loading"),t.expand.call(n)}));"string"!==e.type(r.source)||n.hasClass("loading")||(n.addClass("loading"),e.post(r.source,{id:s(n)},function(e){n.removeDate("loadNeeded").data("loaded",!0),a(n,e),n.removeClass("loading")},"json"));return!1}(n))&&(r(n),!0)}),k&&B(),this},collapse:function(){return this.each(function(){var t=e(this);u(t)&&(!function(e){var t=e.closest("table").data("treegrid-settings");if(!t.onCollapse.call(e))return;e.removeClass("expanded"),e.find(">td:first>.treegrid-container>.fa").removeClass(t.iconClose).addClass(t.iconOpen),d(e).not(e).hide()}(t),!0)}),k&&B(),this},add:function(t){return this.each(function(){a(e(this),t)}),k&&B(),this},addItemInActionExpand:function(t,r){for(var i=document.querySelector(".treegrid-"+t),o=2,d=0;d<r.length;d++)o=n(o),r[d]=r[d].replace("<tr>",'<tr class="treegrid-'+o+'">');a(e(i),r)},getAllParent:function(t){for(var n=e(".treegrid-"+t),r=[],a=0;;a++){var o=s(n);if(null==o)break;r[a]=o,n=i(n)}return r.reverse()},addItemInActionExpandWithId:function(t,n){var i=document.querySelector(".treegrid-"+t);a(e(i),n),r(e(i))},remove:function(){return this.each(function(){var t=e(this),n=i(t);d(t).remove(),f(n,n.data("treegrid-depth"))}),k&&B(),this},move:function(e,t){var n,r,a,o=i(this);if(a=d(this),n=0==t?e.prev():d(e).not(a).last(),-1==a.index(n)){r=1===t?s(e):l(e),this.removeClass("treegrid-parent-"+l(this)),null!==r&&this.addClass("treegrid-parent-"+r),n.length?a.insertAfter(n):a.prependTo(this.parent()),h(this)&&a.hide(),o.length&&f(o,o.data("treegrid-depth"));var c=i(this);c.length?f(c,c.data("treegrid-depth")):f(this)}},getRoots:function(){var t=[];return this.find(">tbody>tr").each(function(){null===l(e(this))&&t.push(this)}),e(t)},getChildNodes:function(){var t=e();return this.each(function(){t=t.add(o(e(this)))}),t},getBranch:function(){var t=e();return this.each(function(){t=t.add(d(e(this)))}),t},getParent:function(){var t=e();return this.each(function(){t=t.add(i(e(this)))}),t},isCollapsed:function(){var t=!1;return this.each(function(){if(t=c(e(this)))return!1}),t},isExpanded:function(){var t=!1;return this.each(function(){if(t=u(e(this)))return!1}),t}};function n(e){for(;;e++){if(null===document.querySelector(".treegrid-"+e))return e}}function r(t){var n=t.closest("table").data("treegrid-settings");n.onExpand.call(t)&&(t.addClass("expanded"),t.find(">td:first>.treegrid-container>.fa").removeClass(n.iconOpen).addClass(n.iconClose),d(t).not(t).each(function(){var t=e(this);h(t)?t.hide():t.show()}))}function a(t,n){var r,a=d(t).last().next(),i=[],o=s(t),l=t;"TABLE"!==l.prop("tagName")&&(l=l.closest("table")),r=l.find(">thead>tr,>tbody>tr").first().find(">th,>td").length,e.each(n,function(t,n){var d=e(n);if(!l.find(">tbody>tr.treegrid-"+s(d)).length){null!==o&&d.addClass("treegrid-parent-"+o);var c=d.find(">td").length;if(c<r)for(t=d.find(">td").length;t<r;t++)d.append("<td>");else c>r&&d.find(">td").eq(r-1).nextAll().remove();a.length?d.insertBefore(a):l.find(">tbody").append(d),i.push(d[0])}}),i=e(i),null===o&&f(i),f(t,t.data("treegrid-depth")),t.closest("table").data("treegrid-settings").onAdd.call(t,i)}function i(e){return e.parent().find(">.treegrid-"+l(e))}function o(e){return e.parent().find(">.treegrid-parent-"+s(e))}function d(t){var n=t;return"TR"!==t.prop("tagName")?n.not(t):(o(t).each(function(){n=n.add(d(e(this)))}),n)}function s(e){var t=/treegrid-([A-Fa-f0-9_]+)/;return t.test(e.attr("class"))?t.exec(e.attr("class"))[1]:null}function l(e){var t=/treegrid-parent-([A-Fa-f0-9_]+)/;return t.test(e.attr("class"))?t.exec(e.attr("class"))[1]:null}function c(e){return e.data("count")&&!e.hasClass("expanded")}function u(e){return e.data("count")&&e.hasClass("expanded")}function f(t,n,r){void 0===n&&(n=1);var a=t.closest("table").data("treegrid-settings"),i=0,d=!1;t.each(function(){var t=e(this).data("treegrid-depth",n),s=o(t),c=s.length;if(void 0===t.data("count")||t.data("loaded")||t.data("count")==c?t.data("loadNeeded")||(t.data({loaded:!0,count:c}),c&&r&&t.addClass("expanded")):t.data("loadNeeded",!0),$td=t.find(">td:first"),$container=$td.find(">.treegrid-container"),0===$container.length&&($container=e('<div class="treegrid-container">').html($td.html()),$td.html("").append($container)),$container.find(".fa-caret").remove(),a.clickAllTd){const t='<span class="fa" style="margin-right: '+a.marginExpand+'">';$expander=e(t).prependTo($container),$container.css("cursor","pointer")}else{const t='<span class="fa" style="cursor: pointer; margin-right: '+a.marginExpand+'">';$expander=e(t).prependTo($container)}var u=function(t){for(var n=0,r=t;null!=r;){var a=l(r);if(null==a)break;r=e(".treegrid-"+a),n++}return n}(t);0==u&&(d=!0),t.data("count")?t.hasClass("expanded")?($expander.addClass(a.iconClose),g($td,a)):(g($td,a),s.length>0?($expander.addClass(a.iconClose),t.addClass("expanded")):$expander.addClass(a.iconOpen)):a.defaulIconIsNull||(g($td,a),a.maxLevelTree>u&&(s.length>0?($expander.addClass(a.iconClose),t.addClass("expanded")):$expander.addClass(a.iconOpen))),null!=a.arrayLevelBackgroundColor&&t.css("background").indexOf("rgba(0, 0, 0, 0)")>-1&&(i%2==1?t.css("background",a.arrayLevelBackgroundColor[u]):t.css("background",a.arrayLevelBackgroundColor2[u]),i++),u>0&&$container.css("marginLeft",u*a.marginLeftAdd),null!=a.arrayLevelTextColor&&t.css("color",a.arrayLevelTextColor[u]),h(t)&&d&&t.hide(),f(s,n+1,r)})}function g(e,t){var n=e.find("."+t.iconClose+":first"),r=e.find("."+t.iconOpen+":first");null!=n&&n.remove(),null!=r&&r.remove()}function p(){var n,a,i=(a=e(e(n=this).find(".fa"))).length>0?a:e(n),o=i.closest("table").data("treegrid-settings"),d=function(e){var t=e.parent().parent().parent();if(null==t)return null;var n=t.attr("class").split(" ");if(null==n)return null;for(var r=0;r<n.length;r++){var a=n[r];if(0==a.indexOf("treegrid-"))return a.split("treegrid-")[1]}return null}(i),s=e(".treegrid-parent-"+d).length;!o.defaulIconIsNull&&null!=o.onActionExpand&&i.hasClass(o.iconOpen)&&0==s?(o.onActionExpand(d,t),i.removeClass(o.iconOpen),i.addClass(o.iconClose),r(i)):(i.hasClass(o.iconOpen)||i.hasClass(o.iconClose))&&t.toggle.call(i.closest("tr"))}function h(e){if(null===l(e))return!1;var t=i(e);return!!c(t)||h(t)}var v,m,C,x,b,y,$,A=null,T=null,O=null,k=!1,M=!1,w=!1;function L(t){if(0===t.button){var n=e(this),r=n.closest("table").data("treegrid-settings");if(r.enableMove){var a=e(t.target);if(!a.hasClass(iconOpen)&&(!1===r.moveHandle||n.find(r.moveHandle)[0]==a[0])){A=n.closest("tr"),m=t.pageX,C=t.pageY;var i=n.offset();return x=i.left-t.pageX,b=i.top-t.pageY,e(document).on("mouseup",E).on("mousemove",I),!1}}}}function E(n){k&&function(){k=!1,!1!==w&&(window.clearTimeout(w),w=!1);T.remove(),v.remove();var e=A.closest("table");e.data("treegrid-settings").onMoveStop.call(e,A),M&&function(){N();var e=A.closest("table");!1!==e.data("treegrid-settings").onMove.call(e,A,O,$)&&t.move.call(A,O,$)}()}(),e(document).off("mouseup",E).off("mousemove",I)}function I(n){Math.max(Math.abs(n.pageX-m),Math.abs(n.pageY-C))>=A.closest("table").data("treegrid-settings").moveDistance&&!k?function(t){if(k=!0,B(),T=A.find(">td:first>.treegrid-container").clone().addClass("dragging").css({left:t.pageX+x,top:t.pageY+b}),(T=A.find(">td:first>.treegrid-container").clone().addClass("dragging")).find(">.fa").remove(),T.appendTo("body"),e(".treegrid-move-indicator").length)return;v=e('<div class="treegrid-move-indicator">').appendTo("body");var n=A.closest("table");n.data("treegrid-settings").onMoveStart.call(n,A,T)}(n):k&&function(n){var r=function(t,n){var r=null,a={node:null,position:null,top:null};if(e.each(y,function(e,i){if(t>=i[0]&&n>=i[1]&&t<=i[0]+i[2]&&n<=i[1]+i[3])return r=i,a.node=i[4],!1}),null!==r){var i=r[3]/4,o=3*i,d=n-r[1];d<i?(a.position=0,a.top=r[1]):d>=o?(a.position=2,a.top=r[1]+r[3]):(a.position=1,a.top=r[1]+r[3]/2)}return a}(n.pageX,n.pageY);if(O===r.node&&$===r.position)return;null!==O&&N();O=r.node,$=r.position,null!==O&&function(e){if(1==e.position){var n=e.node;!1===w&&c(n)&&(w=window.setTimeout(function(){t.expand.call(n),w=!1},500))}else!1!==w&&(window.clearTimeout(w),w=!1);M=!0;var r=A.closest("table");!1===r.data("treegrid-settings").onMoveOver.call(r,A,T,e.node,e.position)&&(M=!1);M&&v.css({display:"block",left:e.node.find(">td:first>.treegrid-container").offset().left,top:e.top})}(r)}(n)}function N(){!1!==w&&(window.clearTimeout(w),w=!1),M=!1,v.hide();var e=A.closest("table");e.data("treegrid-settings").onMoveOut.call(e,A,T,O)}function B(){var t=[];d(A).each(function(){t.push(s(e(this)))}),y=[],A.parent().find("tr").each(function(){var n=e(this),r=s(n);if(null!==r&&-1===e.inArray(r,t)){var a=n.offset();y.push([a.left,a.top,n.width(),n.height(),n])}})}}(jQuery);